name: My Artifacts
on: push

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
          - name: clone the repo
            uses: actions/checkout@v4
          - name: install python
            uses: actions/setup-python@v5
            with:
              python-version: '3.10' 

# setup a cache for the poetry install
          - name: cache poetry install
            uses: actions/cache@v4
            with:
              path: ~/.local
              key: poetry-1.8.2

# install poetry
          - name: Install Poetry
            uses: snok/install-poetry@v1
            with:
                version: 1.8.2
                virtualenvs-create: true
                virtualenvs-in-project: true
          
# setup a cache for the dependencies
          - name: cache deps
            id: cache-deps
            uses: actions/cache@v4
            with:
              path: .venv
              key: deps-${{ hashFiles('**/poetry.lock') }}

# install the dependencies
          - name: Install Dep
            run: poetry install --no-interaction --no-root
            if: steps.cache-deps.outputs.cache-hit != 'true'

          - name: Run Tests
            id: running_test
            run: poetry run pytest --rootdir=.
            
          - name: Dummy echo
            if: failure() && steps.running_test.outcome == 'failure'
            run: |
              echo "Hello from dummy echo"

          - name: the last step
            run: |
              echo "Hello from the last"              